{% include 'operator/o_header.html' %}
       <!--谷歌地图调用api-->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD3vT3UOTtr5GYl6yqo3wLfmaiElz66hIw" async defer></script>

	<script>

    function initialize()
    {
      var mapProp = {
        center: new google.maps.LatLng(55.87189,-4.28922),
        zoom:7,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      var map = new google.maps.Map(document.getElementById("googleMap"),mapProp);
    }

    function loadScript()
    {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyD3vT3UOTtr5GYl6yqo3wLfmaiElz66hIw&sensor=false&callback=initialize";
      document.body.appendChild(script);
    }


    window.onload = loadScript;

    </script>

<!-- //about breadcrumb -->
 <section class="w3l-contact-11 py-5" id="contact">
     <div class="contacts-main py-lg-5 py-md-4">
         <div class="form-41-mian mt-5 pt-lg-5 pt-md-4">
             <div class="container">
                 <div class="d-grid align-form-map">
                    <div class="map" id = "googleMap" style="width:100%;height:500px;border: 200px;padding:100px;">
                     </div>
                     <div class="form-inner-cont">
                         <form name="repair-form" id="repair-form"
                               action="../o_manage_bike/repairBikeDo" method="post" >
                             {% csrf_token %}
                             <div class="form-input">
                                 <label for="bikeId">Bike ID</label>
                                 <input type="text" name="bikeId" id="bikeId" placeholder="" />
                                 <button type="button" id="search" class="btn btn-primary btn-style">Search</button>
                             </div>
                             <div class="form-input">
                                 <label for="report">Report From User</label>
                                 <textarea  name="report" id="report" placeholder="Please fix tire " ></textarea>
                             </div>
                             <div class="form-input">
                                 <label for="location">Location Where Repair Is Given</label>
                                 <textarea  name="location" id="location" placeholder="Glasgow" ></textarea>
                             </div>
                             <div class="form-input">
                                 <label for="photo"><span style="color: #FF0000;">*</span> Image:</label>
                                 <input type="file" id="photo" name="photo" />
                             </div>
                             <button type="button" id="start" class="btn btn-primary btn-style">Start Investigation</button>
                             <button type="button" id="end" class="btn btn-primary btn-style">Finish Repair</button>
                             <input type="text" id="time" class="time" value=""
                                    placeholder="Start time and finish time appears"
                                    style="margin-top:25px"/>
                             <div class="layout_m_infobtnsave">
                                 <input id="button_save" href="#" class="layout_button btn btn-primary btn-style" type="button" value="Submit"/>
                             </div>
                         </form>
                     </div>
                 </div>
             </div>
         </div>
     </div>
 </section>

<script>
$(document).ready(function(){
    $('#search').click(function () {
        let bikeId= $('#bikeId').val().trim();
        if (bikeId=='') {
            alert("Please input your bike ID");
            return;
        }
        $.ajax({
            url:"/o_manage_bike/repairBikeDo",
            type:"GET",
            data:{ bikeId },
            success:function(data){
                if (data != 'BikeIDError') $('#report').val(data)
                else alert(`There is no matching bike ID (${bikeId}) reported defective.`)
            },
            fail:function(data){
                alert("false")
            }
        })
    })
let startTime, endTime;

$('#start').click(function() {
    startTime = new Date().toLocaleString();
    $('#time').val(`Start: ${startTime}`)
    this.disabled = true
})

$('#end').click(function() {
    endTime = new Date().toLocaleString();
    let val = $('#time').val()
    $('#time').val(`${val} \nEnd: ${endTime}`)
    this.disabled = true
})

$('#button_save').click(function () {
    let bikeId = $("#bikeId").val(), location = $("#location").val();

    $.ajax({
        url:"/o_manage_bike/addNewRepairDo",
        type:"POST",
        data:{ bikeId, location },
        success: function(data){
            alert(data)
            return;
            if(data == "success"){
                alert("Added successfully")
                // window.location.href = "../a_manage_location/index"
            }
            else{
                alert("Error")
            }
        },
        fail:function(data){
            alert(123)
            alert("false")
        }
    })
})






})

</script>

{% include 'operator/o_footer.html' %}