{% include 'admin/a_header.html' %}
<link rel="stylesheet" type="text/css" href="../../static/admin/css/a_add_bike.css" />
<link rel='stylesheet' type='text/css' href='../../static/admin/css/a_index.css' />

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD3vT3UOTtr5GYl6yqo3wLfmaiElz66hIw&callback=initMap&libraries=&v=weekly" async></script>


<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <style type="text/css">
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }

      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <script>
      function initMap() {
        const myLatlng = { lat: -25.363, lng: 131.044 };
        const map = new google.maps.Map(document.getElementById("googleMap"), {
          zoom: 4,
          center: myLatlng,
        });
        // Create the initial InfoWindow.
        let infoWindow = new google.maps.InfoWindow({
          content: "Click the map to get Lat/Lng!",
          position: myLatlng,
        });
        infoWindow.open(map);
        // Configure the click listener.
        map.addListener("click", (mapsMouseEvent) => {
          // Close the current InfoWindow.
          infoWindow.close();
          // Create a new InfoWindow.
          infoWindow = new google.maps.InfoWindow({
            position: mapsMouseEvent.latLng,
          });
          infoWindow.setContent(
            JSON.stringify(mapsMouseEvent.latLng.toJSON(), null, 2)
          );
          infoWindow.open(map);
        });
      }

	// Add a marker to the map.
	function placeMarker(location, map) {
		if (marker) {
			marker.setPosition(location);
		} else {
			marker = new google.maps.Marker({
				position: location,
				map: map
			});
		}
	}
</script>

<div class="layout_m_content">
	<div class="layout_m_contitle">Add a New Location</div>
	<div class="layout_m_infoupcontent">
		<form action="../a_manage_location/addNewLocation" method="post"
			  name="add_location" id="add_location">
			{% csrf_token %}
			<table border="0">
				<tr>
					<td for="id">Location ID:</td>
					<td><input type="number" class="" name="id" id="id"/></td>
				</tr>
				<tr>
					<td for="name">Location Name:</td>
					<td><input type="text" class="" name="name" id="name" /></td>
				</tr>
				<tr>
					<td for="types">Location Type:</td>
					<td>
						<select name="types" id="types" class="">
							<option value="city">City</option>
							<option value="bicycle">Bicycle</option>
						</select>
					</td>
				</tr>
				<tr>
					<td for="lng">Longitude:</td>
					<td><input type="number" name="lng" id="lng" class="" /></td>
				</tr>
				<tr>
					<td for="lat">Latitude:</td>
					<td><input type="number" name="lat" id="lat" class="" /></td>
				</tr>
				<tr>
					<td class="layout_m_infomcon">
						<span style="color: #FF0000;">*</span> Image:
					</td>
					<td><input  type="file" id="photo" name="photo" /></td>
				</tr>
			</table>
			<div class="layout_m_infobtnsave">
				<input id="button_save" href="#" class="layout_button" type="submit" value="Submit"/>
			</div>

		</div>
  <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD3vT3UOTtr5GYl6yqo3wLfmaiElz66hIw&callback=initMap&libraries=&v=weekly"
      async
    ></script>

		</form>

		<div class="map" id="googleMap" style=""></div>
	</div>
</div>



<script>
$(function() {
	$("#button_save").click(function(){
		$("form[name='add_location']").validate({
			rules: {
				id: "required",
				name: "required",
				lng: "required",
				lat: "required",
				photo: "required"
			},
			messages: {
				id: "Please enter ID",
				name: "Please enter location name",
				lng: "Please pick any point in map or enter any number",
				lat: "Please pick any point in map or enter any number",
				photo: "Please upload photo"
			},
			submitHandler: function (form) {
				let id = $("#id").val(), name = $("#name").val(),
					lng = $("#lng").val(), lat = $("#lat").val(),
					types = $("#types").val();
				$.post({
					url:"/a_manage_location/addNewLocation_do",
					type:"POST",
					data:{
						id, name, lng, lat, types
					},
					success:function(data){
						if(data == "success"){
							alert("Added successfully")
							window.location.href = "../a_manage_location/addNewLocation"
						}
						else if(data == "repeat"){
							$("#id").val() = "";
							alert("ID is duplicated value")
						}
						else
							alert("Error")
					},
					fail:function(data){
						alert("false")
					}
				})
				form.submit();
			}
		})
	})
})
</script>

<!--{% include 'admin/a_foot.html' %}-->
